"use strict";let mainBlock=document.querySelector(".cards"),logo=document.querySelector(".header--logo");function cutText(){let e=Array.prototype.slice.call(document.querySelectorAll(".cards--text"));for(let t=0;t<e.length;t++){let n=e[t].textContent.slice(0,100).trim();n+="...",e[t].textContent=n}}function loadJson(){fetch("service.json").then(e=>e.json()).then(e=>{showCards(e.services)})}function showCards(e){for(let t=0;t<e.length;t++){let n=document.createElement("div");n.classList.add("cards--item"),n.setAttribute("data-alias",e[t].alias),console.log(e),n.innerHTML=`\n        <img class="cards--img" src=${e[t].image} alt="">\n            <div class="cards--description">\n                <h2 class="cards--tittle">${e[t].title}</h2>\n                <p class="cards--text">${e[t].description}</p>\n                <div class="cards-tags">\n            </div>\n        </div>`,mainBlock.insertAdjacentElement("beforeend",n);let a=n.querySelector(".cards-tags");for(let o=0;o<e[t].properties.length;o++){"вода"===e[t].properties[o].value&&n.setAttribute("data-query3",e[t].properties[o].value.replace(" ","")),"профи"===e[t].properties[o].value&&n.setAttribute("data-query4",e[t].properties[o].value.replace(" ","")),"мастер"===e[t].properties[o].value&&n.setAttribute("data-query4",e[t].properties[o].value.replace(" ","")),n.setAttribute(`data-query${[o]}`,e[t].properties[o].value.replace(" ",""));let i=document.createElement("span");i.innerHTML=`#${e[t].properties[o].value}`,a.insertAdjacentElement("beforeend",i)}}cutText()}logo.addEventListener("click",(function(){window.location.pathname="/"}));const mainPageTemplate=function(){return'<section class="inputs">\n    <div class="input input--quantity">\n        <select data-query="query0" class="select filter__quantity" name="filter__quantity">\n            <option value="">Количество занятий</option>\n            <option value=\'100занятий\'>100 занятий</option>\n            <option value=\'36занятий\'>36 занятий</option>\n            <option value=\'18занятий\'>18 занятий</option>\n            <option value=\'разовоепосещение\'>разовое посещение</option>\n        </select>\n    </div>\n    <div class="input input--validity">\n        <select data-query="query1" class="select filter__validity" name="filter__validity">\n            <option value="">Срок действия</option>\n            <option value=\'1год\'>1 год</option>\n            <option value=\'6месяцев\'>6 месяцев</option>\n            <option value=\'1месяц\'>1 месяц</option>\n        </select>\n    </div>\n    <div class="input input--time">\n        <select data-query="query2" class="select filter__time" name="filter__time">\n            <option value="">Время помещения</option>\n            <option value=\'утро\'>утро</option>\n            <option value=\'вечер\'>вечер</option>\n        </select>\n    </div>\n    <div class="input input--type">\n        <select data-query="query3" class="select filter__type" name="filter__type">\n            <option value="">Тип секции</option>\n            <option value=\'вода\'>вода</option>\n        </select>\n    </div>\n    <div class="input input--category">\n        <select data-query="query4" class="select filter__category" name="filter__category">\n            <option value="">Категория тренера</option>\n            <option value=\'мастер\'>мастер</option>\n            <option value=\'профи\'>профи</option>\n        </select>\n    </div>\n    </section>'},cardPageTemplate=function(){return'<section class="card">\n    <div class="container container--card">\n        <div class="card--img">\n        <img src="", width="400" alt="">\n        </div>\n        <div class="card-description">\n            <h2 class="card--tittle">Мультикарта Fitness House</h2>\n            <p class="card--text">Абонемент на посещение любого спортивного клуба сети Fitness House в течении 1 года но не более 100 занятий в свбодное время.</p>\n            <p class="card--count">Колличество занятий - 100 занятий</p>\n            <p class="card--term">Срок действия - 1 год</p>\n            <div class="card--summary">\n            <div class="price">5 000</div>\n            <button class="card-button">Купить</button>\n            </div>\n            </div>\n    </div>\n</section>'},PageType={MainPageType:"main",CardPageType:"card",DefaultPageType:"main"},templates={[PageType.MainPageType]:mainPageTemplate,[PageType.CardPageType]:cardPageTemplate,[PageType.DefaultPageType]:mainPageTemplate};let container=document.body.querySelector(".main--container");const router={set(e){let t=templates[e]();container.insertAdjacentHTML("afterbegin",t)}};function loadDefaultPages(){router.set(PageType.DefaultPageType),loadJson()}function openCard(e){if(e.target.classList.contains("cards--img")){let t=e.target.parentNode.getAttribute("data-alias");clearContainer(),fetch("service.json").then(e=>e.json()).then(e=>{const n=e.services;changeRouting(t,n)})}}function clearContainer(){container.innerHTML=""}function showSingleCard(e,t){let n=document.createElement("section");n.classList.add("card"),n.innerHTML=`\n            <div class="container container--card">\n                <div class="card--img">\n                <img src=${e[t].image} width="400" alt="">\n                </div>\n                <div class="cards--description">\n                    <h2 class="card--tittle">Мультикарта Fitness House</h2>\n                    <p class="card--text">${e[t].description}</p>\n                    <p class="card--count">Колличество занятий - ${e[t].properties[0].value}</p>\n                    <p class="card--term">Срок действия - ${e[t].properties[1].value}</p>\n                    <div class="card--summary">\n                        <div class="price">${e[t].price}</div>\n                        <button class="card-button">Купить</button>\n                    </div>\n                </div>\n            </div>`,container.insertAdjacentElement("beforeend",n)}loadDefaultPages(),container.addEventListener("click",openCard,!0);let buttons=Array.from(document.querySelectorAll(".card-button")),headerCount=document.querySelector(".header--count > span"),count=sessionStorage.getItem("count");function navigationToGo(e){window.history.pushState({},e,window.location.origin+e)}function changeRouting(e,t){switch(e){case"multikarta-fitness-house":showSingleCard(t,0),navigationToGo("/multikarta-fitness-house");break;case"abonement-fitness-house":showSingleCard(t,1),navigationToGo("/abonement-fitness-house");break;case"detskaya-sekcia-voda":showSingleCard(t,2),navigationToGo("/detskaya-sekcia-voda");break;case"paket-prsonalnih-trenirovok":showSingleCard(t,3),navigationToGo("/paket-prsonalnih-trenirovok");break;case"gruppovie-zanatiya":showSingleCard(t,4),navigationToGo("/gruppovie-zanatiya");break;case"master-class":showSingleCard(t,5),navigationToGo("/master-class");break}}function filter(){setTimeout(()=>{const e=Array.from(document.getElementsByClassName("select")),t=Array.from(document.getElementsByClassName("cards--item")),n={};function a(e){const a=e.target.dataset.query;event.target.value?n[a]=e.target.value:delete n[a];const o=t.filter(e=>Object.entries(n).every(([t,n])=>e.dataset[t]===n));t.forEach(e=>(function(e){e.style.display="none"})(e)),o.forEach(e=>(function(e){e.style.display="block"})(e))}e.forEach(e=>e.addEventListener("change",a))},1e3)}document.body.addEventListener("click",(function(e){e.target.classList.contains("card-button")&&(count=sessionStorage.getItem("count"),count++,sessionStorage.setItem("count",count),headerCount.innerHTML=sessionStorage.getItem("count"))}),!0),headerCount.innerHTML=sessionStorage.getItem("count")?sessionStorage.getItem("count"):"0",window.onpopstate=function(e){if(filter(),"/"===window.location.pathname){clearContainer();let e=document.createElement("section");e.classList.add("cards"),container.append(e),mainBlock=document.querySelector(".cards"),loadDefaultPages(),filter()}"/multikarta-fitness-house"===window.location.pathname&&(clearContainer(),fetch("service.json").then(e=>e.json()).then(e=>{showSingleCard(e.services,0)})),"/abonement-fitness-house"===window.location.pathname&&(clearContainer(),fetch("service.json").then(e=>e.json()).then(e=>{showSingleCard(e.services,1)})),"/detskaya-sekcia-voda"===window.location.pathname&&(clearContainer(),fetch("service.json").then(e=>e.json()).then(e=>{showSingleCard(e.services,2)})),"/paket-prsonalnih-trenirovok"===window.location.pathname&&(clearContainer(),fetch("service.json").then(e=>e.json()).then(e=>{showSingleCard(e.services,3)})),"/gruppovie-zanatiya"===window.location.pathname&&(clearContainer(),fetch("service.json").then(e=>e.json()).then(e=>{showSingleCard(e.services,4)})),"/master-class"===window.location.pathname&&(clearContainer(),fetch("service.json").then(e=>e.json()).then(e=>{showSingleCard(e.services,5)}))},filter();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsibWFpbkJsb2NrIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibG9nbyIsImN1dFRleHQiLCJ0ZXh0cyIsIkFycmF5IiwicHJvdG90eXBlIiwic2xpY2UiLCJjYWxsIiwicXVlcnlTZWxlY3RvckFsbCIsImkiLCJsZW5ndGgiLCJlbGVtIiwidGV4dENvbnRlbnQiLCJ0cmltIiwibG9hZEpzb24iLCJmZXRjaCIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJhbnN3ZXIiLCJzaG93Q2FyZHMiLCJzZXJ2aWNlcyIsImRhdGEiLCJibG9jayIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzZXRBdHRyaWJ1dGUiLCJhbGlhcyIsImNvbnNvbGUiLCJsb2ciLCJpbm5lckhUTUwiLCJpbWFnZSIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJpbnNlcnRBZGphY2VudEVsZW1lbnQiLCJkaXZGb3JTcGFuIiwiaiIsInByb3BlcnRpZXMiLCJ2YWx1ZSIsInJlcGxhY2UiLCJzcGFuIiwiYWRkRXZlbnRMaXN0ZW5lciIsIndpbmRvdyIsImxvY2F0aW9uIiwicGF0aG5hbWUiLCJtYWluUGFnZVRlbXBsYXRlIiwiY2FyZFBhZ2VUZW1wbGF0ZSIsIlBhZ2VUeXBlIiwiTWFpblBhZ2VUeXBlIiwiQ2FyZFBhZ2VUeXBlIiwiRGVmYXVsdFBhZ2VUeXBlIiwidGVtcGxhdGVzIiwiW29iamVjdCBPYmplY3RdIiwiY29udGFpbmVyIiwiYm9keSIsInJvdXRlciIsInJvdXRlVHlwZSIsInJlbmRlckh0bWwiLCJpbnNlcnRBZGphY2VudEhUTUwiLCJsb2FkRGVmYXVsdFBhZ2VzIiwic2V0Iiwib3BlbkNhcmQiLCJldmVudCIsInRhcmdldCIsImNvbnRhaW5zIiwiYXR0ciIsInBhcmVudE5vZGUiLCJnZXRBdHRyaWJ1dGUiLCJjbGVhckNvbnRhaW5lciIsInJlc3VsdCIsImNoYW5nZVJvdXRpbmciLCJzaG93U2luZ2xlQ2FyZCIsInByaWNlIiwiYnV0dG9ucyIsImZyb20iLCJoZWFkZXJDb3VudCIsImNvdW50Iiwic2Vzc2lvblN0b3JhZ2UiLCJnZXRJdGVtIiwibmF2aWdhdGlvblRvR28iLCJwYXRoTmFtZSIsImhpc3RvcnkiLCJwdXNoU3RhdGUiLCJvcmlnaW4iLCJmaWx0ZXIiLCJzZXRUaW1lb3V0Iiwic2VsZWN0cyIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJibG9ja3MiLCJxdWVyeSIsInVwZGF0ZVF1ZXJ5IiwiZSIsInVwZGF0ZWRRdWVyeSIsImRhdGFzZXQiLCJibG9ja3NUb1Nob3ciLCJPYmplY3QiLCJlbnRyaWVzIiwiZXZlcnkiLCJrZXkiLCJmb3JFYWNoIiwic3R5bGUiLCJkaXNwbGF5IiwiaGlkZUJsb2NrIiwic2hvd0Jsb2NrIiwic2VsZWN0Iiwic2V0SXRlbSIsIm9ucG9wc3RhdGUiLCJzZWN0aW9uQ2FyZHMiLCJhcHBlbmQiXSwibWFwcGluZ3MiOiJBQUFBLGFBRUEsSUFBSUEsVUFBWUMsU0FBU0MsY0FBYyxVQUNuQ0MsS0FBT0YsU0FBU0MsY0FBYyxpQkFRbEMsU0FBU0UsVUFDTCxJQUFJQyxFQUFRQyxNQUFNQyxVQUFVQyxNQUFNQyxLQUFLUixTQUFTUyxpQkFBaUIsaUJBQ2pFLElBQUssSUFBSUMsRUFBSSxFQUFHQSxFQUFJTixFQUFNTyxPQUFRRCxJQUFLLENBQ25DLElBQUlFLEVBQU9SLEVBQU1NLEdBQUdHLFlBQVlOLE1BQU0sRUFBRSxLQUFLTyxPQUM3Q0YsR0FBTyxNQUNQUixFQUFNTSxHQUFHRyxZQUFjRCxHQU0vQixTQUFTRyxXQUNMQyxNQUFNLGdCQUNMQyxLQUFLQyxHQUFZQSxFQUFTQyxRQUMxQkYsS0FBS0csSUFFRkMsVUFEZUQsRUFBT0UsWUFPOUIsU0FBU0QsVUFBVUUsR0FDZixJQUFLLElBQUliLEVBQUksRUFBR0EsRUFBSWEsRUFBS1osT0FBUUQsSUFBSyxDQUNsQyxJQUFJYyxFQUFReEIsU0FBU3lCLGNBQWMsT0FDbkNELEVBQU1FLFVBQVVDLElBQUksZUFDcEJILEVBQU1JLGFBQWEs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LFNBQVNDLFdBQ2hCd0IsaUJBQ0F0RCxNQUFNLGdCQUNMQyxLQUFLQyxHQUFZQSxFQUFTQyxRQUMxQkYsS0FBS0csSUFHRnFELGVBRmVyRCxFQUFPRSxTQUNkLE1BS2lCLGtCQUE3QnNCLE9BQU9DLFNBQVNDLFdBQ2hCd0IsaUJBQ0F0RCxNQUFNLGdCQUNMQyxLQUFLQyxHQUFZQSxFQUFTQyxRQUMxQkYsS0FBS0csSUFHRnFELGVBRmVyRCxFQUFPRSxTQUNkLE9BcURwQmdFIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmxldCBtYWluQmxvY2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZHMnKTtcbmxldCBsb2dvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlci0tbG9nbycpO1xuXG5sb2dvLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID0gXCIvXCI7XG59KTtcblxuLy8g0KTRg9C90LrRhtC40Y8g0L7Qs9GA0LDQvdC40YfQtdC90LjRjyDRgtC10LrRgdGC0LAg0LTQu9GPINC60LDRgNGC0L7Rh9C10Loo0L3QtSDQsdC+0LvQtdC1IDEwMCDRgdC40LzQstC+0LvQvtCyKVxuXG5mdW5jdGlvbiBjdXRUZXh0KCkge1xuICAgIGxldCB0ZXh0cyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jYXJkcy0tdGV4dCcpKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRleHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxldCBlbGVtID0gdGV4dHNbaV0udGV4dENvbnRlbnQuc2xpY2UoMCwxMDApLnRyaW0oKTtcbiAgICAgICAgZWxlbSArPScuLi4nO1xuICAgICAgICB0ZXh0c1tpXS50ZXh0Q29udGVudCA9IGVsZW07XG4gICAgfTtcbn07XG5cbi8vINCX0LDQv9GA0L7RgSDQvdCwINC30LDQs9GA0YPQt9C60YMg0LTQsNC90L3Ri9GFINC4INC/0L7QutCw0Lcg0LrQsNGA0YLQvtGH0LXQulxuXG5mdW5jdGlvbiBsb2FkSnNvbigpIHtcbiAgICBmZXRjaCgnc2VydmljZS5qc29uJylcbiAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG4gICAgLnRoZW4oYW5zd2VyID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYW5zd2VyLnNlcnZpY2VzO1xuICAgICAgICBzaG93Q2FyZHMocmVzdWx0KTtcbiAgICB9KTtcbn07XG5cbi8vINCk0YPQvdC60YbQuNGPINC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0LrQsNGA0YLQvtGH0LXQuiDQvdCwINGB0YLRgNCw0L3QuNGG0YNcblxuZnVuY3Rpb24gc2hvd0NhcmRzKGRhdGEpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IGJsb2NrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGJsb2NrLmNsYXNzTGlzdC5hZGQoJ2NhcmRzLS1pdGVtJyk7XG4gICAgICAgIGJsb2NrLnNldEF0dHJpYnV0ZSgnZGF0YS1hbGlhcycsIGRhdGFbaV0uYWxpYXMpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICBibG9jay5pbm5lckhUTUwgPSBgXG4gICAgICAgIDxpbWcgY2xhc3M9XCJjYXJkcy0taW1nXCIgc3JjPSR7ZGF0YVtpXS5pbWFnZX0gYWx0PVwiXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2FyZHMtLWRlc2NyaXB0aW9uXCI+XG4gICAgICAgICAgICAgICAgPGgyIGNsYXNzPVwiY2FyZHMtLXRpdHRsZVwiPiR7ZGF0YVtpXS50aXRsZX08L2gyPlxuICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwiY2FyZHMtLXRleHRcIj4ke2RhdGFbaV0uZGVzY3JpcHRpb259PC9wPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkcy10YWdzXCI+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+YDtcblxuICAgICAgICBtYWluQmxvY2suaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdiZWZvcmVlbmQnLCBibG9jayk7XG5cbiAgICAgICAgbGV0IGRpdkZvclNwYW4gPSBibG9jay5xdWVyeVNlbGVjdG9yKCcuY2FyZHMtdGFncycpOyBcblxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGRhdGFbaV0ucHJvcGVydGllcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgaWYgKGRhdGFbaV0ucHJvcGVydGllc1tqXS52YWx1ZSA9PT0gJ9Cy0L7QtNCwJykge1xuICAgICAgICAgICAgICAgIGJsb2NrLnNldEF0dHJpYnV0ZSgnZGF0YS1xdWVyeTMnLCBkYXRhW2ldLnByb3BlcnRpZXNbal0udmFsdWUucmVwbGFjZSgnICcsJycpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkYXRhW2ldLnByb3BlcnRpZXNbal0udmFsdWUgPT09ICfQv9GA0L7RhNC4Jykge1xuICAgICAgICAgICAgICAgIGJsb2NrLnNldEF0dHJpYnV0ZSgnZGF0YS1xdWVyeTQnLCBkYXRhW2ldLnByb3BlcnRpZXNbal0udmFsdWUucmVwbGFjZSgnICcsJycpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkYXRhW2ldLnByb3BlcnRpZXNbal0udmFsdWUgPT09ICfQvNCw0YHRgtC10YAnKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suc2V0QXR0cmlidXRlKCdkYXRhLXF1ZXJ5NCcsIGRhdGFbaV0ucHJvcGVydGllc1tqXS52YWx1ZS5yZXBsYWNlKCcgJywnJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBibG9jay5zZXRBdHRyaWJ1dGUoYGRhdGEtcXVlcnkke1tqXX1gLCBkYXRhW2ldLnByb3BlcnRpZXNbal0udmFsdWUucmVwbGFjZSgnICcsJycpKTtcbiAgICAgICAgICAgIGxldCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICAgICAgc3Bhbi5pbm5lckhUTUwgPSBgIyR7ZGF0YVtpXS5wcm9wZXJ0aWVzW2pdLnZhbHVlfWA7XG4gICAgICAgICAgICBkaXZGb3JTcGFuLmluc2VydEFkamFjZW50RWxlbWVudCgnYmVmb3JlZW5kJywgc3Bhbik7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBcbiAgICBjdXRUZXh0KCk7XG59O1xuXG4vLyDQndCw0YLQuNCy0L3Ri9C5INGI0LDQsdC70L7QvdC40LfQsNGC0L7RgFxuXG4vLyDQqNCw0LHQu9C+0L0g0LPQu9Cw0LLQvdC+0Lkg0YHRgtGA0LDQvdC40YbRi1xuXG5jb25zdCBtYWluUGFnZVRlbXBsYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGA8c2VjdGlvbiBjbGFzcz1cImlucHV0c1wiPlxuICAgIDxkaXYgY2xhc3M9XCJpbnB1dCBpbnB1dC0tcXVhbnRpdHlcIj5cbiAgICAgICAgPHNlbGVjdCBkYXRhLXF1ZXJ5PVwicXVlcnkwXCIgY2xhc3M9XCJzZWxlY3QgZmlsdGVyX19xdWFudGl0eVwiIG5hbWU9XCJmaWx0ZXJfX3F1YW50aXR5XCI+XG4gICAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiXCI+0JrQvtC70LjRh9C10YHRgtCy0L4g0LfQsNC90Y/RgtC40Lk8L29wdGlvbj5cbiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9JzEwMNC30LDQvdGP0YLQuNC5Jz4xMDAg0LfQsNC90Y/RgtC40Lk8L29wdGlvbj5cbiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9JzM20LfQsNC90Y/RgtC40LknPjM2INC30LDQvdGP0YLQuNC5PC9vcHRpb24+XG4gICAgICAgICAgICA8b3B0aW9uIHZhbHVlPScxONC30LDQvdGP0YLQuNC5Jz4xOCDQt9Cw0L3Rj9GC0LjQuTwvb3B0aW9uPlxuICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0n0YDQsNC30L7QstC+0LXQv9C+0YHQtdGJ0LXQvdC40LUnPtGA0LDQt9C+0LLQvtC1INC/0L7RgdC10YnQtdC90LjQtTwvb3B0aW9uPlxuICAgICAgICA8L3NlbGVjdD5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwiaW5wdXQgaW5wdXQtLXZhbGlkaXR5XCI+XG4gICAgICAgIDxzZWxlY3QgZGF0YS1xdWVyeT1cInF1ZXJ5MVwiIGNsYXNzPVwic2VsZWN0IGZpbHRlcl9fdmFsaWRpdHlcIiBuYW1lPVwiZmlsdGVyX192YWxpZGl0eVwiPlxuICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIlwiPtCh0YDQvtC6INC00LXQudGB0YLQstC40Y88L29wdGlvbj5cbiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9JzHQs9C+0LQnPjEg0LPQvtC0PC9vcHRpb24+XG4gICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSc20LzQtdGB0Y/RhtC10LInPjYg0LzQtdGB0Y/RhtC10LI8L29wdGlvbj5cbiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9JzHQvNC10YHRj9GGJz4xINC80LXRgdGP0YY8L29wdGlvbj5cbiAgICAgICAgPC9zZWxlY3Q+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImlucHV0IGlucHV0LS10aW1lXCI+XG4gICAgICAgIDxzZWxlY3QgZGF0YS1xdWVyeT1cInF1ZXJ5MlwiIGNsYXNzPVwic2VsZWN0IGZpbHRlcl9fdGltZVwiIG5hbWU9XCJmaWx0ZXJfX3RpbWVcIj5cbiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJcIj7QktGA0LXQvNGPINC/0L7QvNC10YnQtdC90LjRjzwvb3B0aW9uPlxuICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0n0YPRgtGA0L4nPtGD0YLRgNC+PC9vcHRpb24+XG4gICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSfQstC10YfQtdGAJz7QstC10YfQtdGAPC9vcHRpb24+XG4gICAgICAgIDwvc2VsZWN0PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJpbnB1dCBpbnB1dC0tdHlwZVwiPlxuICAgICAgICA8c2VsZWN0IGRhdGEtcXVlcnk9XCJxdWVyeTNcIiBjbGFzcz1cInNlbGVjdCBmaWx0ZXJfX3R5cGVcIiBuYW1lPVwiZmlsdGVyX190eXBlXCI+XG4gICAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiXCI+0KLQuNC/INGB0LXQutGG0LjQuDwvb3B0aW9uPlxuICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0n0LLQvtC00LAnPtCy0L7QtNCwPC9vcHRpb24+XG4gICAgICAgIDwvc2VsZWN0PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJpbnB1dCBpbnB1dC0tY2F0ZWdvcnlcIj5cbiAgICAgICAgPHNlbGVjdCBkYXRhLXF1ZXJ5PVwicXVlcnk0XCIgY2xhc3M9XCJzZWxlY3QgZmlsdGVyX19jYXRlZ29yeVwiIG5hbWU9XCJmaWx0ZXJfX2NhdGVnb3J5XCI+XG4gICAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiXCI+0JrQsNGC0LXQs9C+0YDQuNGPINGC0YDQtdC90LXRgNCwPC9vcHRpb24+XG4gICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSfQvNCw0YHRgtC10YAnPtC80LDRgdGC0LXRgDwvb3B0aW9uPlxuICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0n0L/RgNC+0YTQuCc+0L/RgNC+0YTQuDwvb3B0aW9uPlxuICAgICAgICA8L3NlbGVjdD5cbiAgICA8L2Rpdj5cbiAgICA8L3NlY3Rpb24+YFxufTtcblxuLy8g0KjQsNCx0LvQvtC9INC+0LTQvdC+0Lkg0LrQsNGA0YLQvtGH0LrQuFxuXG5jb25zdCBjYXJkUGFnZVRlbXBsYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGA8c2VjdGlvbiBjbGFzcz1cImNhcmRcIj5cbiAgICA8ZGl2IGNsYXNzPVwiY29udGFpbmVyIGNvbnRhaW5lci0tY2FyZFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY2FyZC0taW1nXCI+XG4gICAgICAgIDxpbWcgc3JjPVwiXCIsIHdpZHRoPVwiNDAwXCIgYWx0PVwiXCI+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY2FyZC1kZXNjcmlwdGlvblwiPlxuICAgICAgICAgICAgPGgyIGNsYXNzPVwiY2FyZC0tdGl0dGxlXCI+0JzRg9C70YzRgtC40LrQsNGA0YLQsCBGaXRuZXNzIEhvdXNlPC9oMj5cbiAgICAgICAgICAgIDxwIGNsYXNzPVwiY2FyZC0tdGV4dFwiPtCQ0LHQvtC90LXQvNC10L3RgiDQvdCwINC/0L7RgdC10YnQtdC90LjQtSDQu9GO0LHQvtCz0L4g0YHQv9C+0YDRgtC40LLQvdC+0LPQviDQutC70YPQsdCwINGB0LXRgtC4IEZpdG5lc3MgSG91c2Ug0LIg0YLQtdGH0LXQvdC40LggMSDQs9C+0LTQsCDQvdC+INC90LUg0LHQvtC70LXQtSAxMDAg0LfQsNC90Y/RgtC40Lkg0LIg0YHQstCx0L7QtNC90L7QtSDQstGA0LXQvNGPLjwvcD5cbiAgICAgICAgICAgIDxwIGNsYXNzPVwiY2FyZC0tY291bnRcIj7QmtC+0LvQu9C40YfQtdGB0YLQstC+INC30LDQvdGP0YLQuNC5IC0gMTAwINC30LDQvdGP0YLQuNC5PC9wPlxuICAgICAgICAgICAgPHAgY2xhc3M9XCJjYXJkLS10ZXJtXCI+0KHRgNC+0Log0LTQtdC50YHRgtCy0LjRjyAtIDEg0LPQvtC0PC9wPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNhcmQtLXN1bW1hcnlcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwcmljZVwiPjUgMDAwPC9kaXY+XG4gICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiY2FyZC1idXR0b25cIj7QmtGD0L/QuNGC0Yw8L2J1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L3NlY3Rpb24+YFxufTtcblxuLy8g0KTRg9C90LrRhtC40Y8g0L7RgtGA0LjRgdC+0LLQutC4INGI0LDQsdC70L7QvdCwXG5cbmNvbnN0IFBhZ2VUeXBlID0ge1xuICAgIE1haW5QYWdlVHlwZTogXCJtYWluXCIsXG4gICAgQ2FyZFBhZ2VUeXBlOiBcImNhcmRcIixcbiAgICBEZWZhdWx0UGFnZVR5cGU6IFwibWFpblwiXG59O1xuXG5jb25zdCB0ZW1wbGF0ZXMgPSB7XG4gICAgWyBQYWdlVHlwZS5NYWluUGFnZVR5cGUgXTogbWFpblBhZ2VUZW1wbGF0ZSxcbiAgICBbIFBhZ2VUeXBlLkNhcmRQYWdlVHlwZSBdOiBjYXJkUGFnZVRlbXBsYXRlLFxuICAgIFsgUGFnZVR5cGUuRGVmYXVsdFBhZ2VUeXBlIF06IG1haW5QYWdlVGVtcGxhdGUsXG59O1xuXG5sZXQgY29udGFpbmVyID0gZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yKCcubWFpbi0tY29udGFpbmVyJyk7XG5cbmNvbnN0IHJvdXRlciA9IHtcbiAgICBzZXQocm91dGVUeXBlKSB7XG4gICAgICAgIGxldCByZW5kZXJIdG1sID0gdGVtcGxhdGVzW3JvdXRlVHlwZV0oKTtcbiAgICAgICAgY29udGFpbmVyLmluc2VydEFkamFjZW50SFRNTCgnYWZ0ZXJiZWdpbicsIHJlbmRlckh0bWwpO1xuICAgIH1cbn07XG5cbmZ1bmN0aW9uIGxvYWREZWZhdWx0UGFnZXMoKSB7XG4gICAgcm91dGVyLnNldChQYWdlVHlwZS5EZWZhdWx0UGFnZVR5cGUpO1xuICAgIGxvYWRKc29uKCk7XG59O1xuXG5sb2FkRGVmYXVsdFBhZ2VzKCk7XG5cbi8vINCd0LDQstC40LPQsNGG0LjRjyDRiNCw0LHQu9C+0L3QuNC30LDRgtC+0YDQsCDQv9C+INC60LDRgNGC0L7Rh9C60LDQvFxuXG5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvcGVuQ2FyZCwgdHJ1ZSk7XG5cbmZ1bmN0aW9uIG9wZW5DYXJkKGV2ZW50KSB7XG4gICAgaWYoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY2FyZHMtLWltZycpKSB7XG4gICAgICAgIGxldCBjYXJkID0gZXZlbnQudGFyZ2V0LnBhcmVudE5vZGU7XG4gICAgICAgIGxldCBhdHRyID0gY2FyZC5nZXRBdHRyaWJ1dGUoJ2RhdGEtYWxpYXMnKTtcblxuICAgICAgICBjbGVhckNvbnRhaW5lcigpO1xuXG4gICAgICAgIGZldGNoKCdzZXJ2aWNlLmpzb24nKVxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG4gICAgICAgIC50aGVuKGFuc3dlciA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhbnN3ZXIuc2VydmljZXM7XG4gICAgICAgICAgICBjaGFuZ2VSb3V0aW5nKGF0dHIsIHJlc3VsdCk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICB9O1xufTtcblxuLy8g0J7Rh9C40YHRgtC60LAg0L/RgNC10LTRi9C00YPRidC10LPQviDRgdC+0YHRgtC+0Y/QvdC40Y8gRE9NINC00LXRgNC10LLQsFxuXG5mdW5jdGlvbiBjbGVhckNvbnRhaW5lcigpIHtcbiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7XG59XG5cbi8vINCk0YPQvdC60YbQuNGPINC+0YLRgNC40YHQvtCy0LrQuCDQvtC00L3QvtC5INC40Lcg0LrQsNGA0YLQvtGH0LXQulxuXG5mdW5jdGlvbiBzaG93U2luZ2xlQ2FyZChkYXRhLCBpKSB7XG4gICAgbGV0IGJsb2NrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VjdGlvbicpO1xuICAgICAgICBibG9jay5jbGFzc0xpc3QuYWRkKCdjYXJkJyk7XG4gICAgICAgIGJsb2NrLmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250YWluZXIgY29udGFpbmVyLS1jYXJkXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNhcmQtLWltZ1wiPlxuICAgICAgICAgICAgICAgIDxpbWcgc3JjPSR7ZGF0YVtpXS5pbWFnZX0gd2lkdGg9XCI0MDBcIiBhbHQ9XCJcIj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2FyZHMtLWRlc2NyaXB0aW9uXCI+XG4gICAgICAgICAgICAgICAgICAgIDxoMiBjbGFzcz1cImNhcmQtLXRpdHRsZVwiPtCc0YPQu9GM0YLQuNC60LDRgNGC0LAgRml0bmVzcyBIb3VzZTwvaDI+XG4gICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwiY2FyZC0tdGV4dFwiPiR7ZGF0YVtpXS5kZXNjcmlwdGlvbn08L3A+XG4gICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwiY2FyZC0tY291bnRcIj7QmtC+0LvQu9C40YfQtdGB0YLQstC+INC30LDQvdGP0YLQuNC5IC0gJHtkYXRhW2ldLnByb3BlcnRpZXNbMF0udmFsdWV9PC9wPlxuICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz1cImNhcmQtLXRlcm1cIj7QodGA0L7QuiDQtNC10LnRgdGC0LLQuNGPIC0gJHtkYXRhW2ldLnByb3BlcnRpZXNbMV0udmFsdWV9PC9wPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2FyZC0tc3VtbWFyeVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInByaWNlXCI+JHtkYXRhW2ldLnByaWNlfTwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImNhcmQtYnV0dG9uXCI+0JrRg9C/0LjRgtGMPC9idXR0b24+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+YDtcbiAgICBjb250YWluZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdiZWZvcmVlbmQnLCBibG9jayk7XG59O1xuXG4vLyDQodGH0LXRgtGH0LjQuiDQutC+0YDQt9C40L3Ri1xuXG5sZXQgYnV0dG9ucyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNhcmQtYnV0dG9uJykpO1xubGV0IGhlYWRlckNvdW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlci0tY291bnQgPiBzcGFuJyk7XG5sZXQgY291bnQgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdjb3VudCcpO1xuXG5kb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY2FyZC1idXR0b24nKSkge1xuICAgICAgICBjb3VudCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2NvdW50Jyk7XG4gICAgICAgIGNvdW50Kys7XG4gICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2NvdW50JywgY291bnQpO1xuICAgICAgICBoZWFkZXJDb3VudC5pbm5lckhUTUwgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdjb3VudCcpO1xuICAgIH0gICAgICAgXG59LCB0cnVlKTtcblxuaGVhZGVyQ291bnQuaW5uZXJIVE1MID0gKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2NvdW50JykpID8gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnY291bnQnKTogJzAnO1xuXG4vLyDQoNC+0YPRgtC40L3Qs1xuXG5mdW5jdGlvbiBuYXZpZ2F0aW9uVG9HbyhwYXRoTmFtZSkge1xuICAgIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZShcbiAgICB7fSwgXG4gICAgcGF0aE5hbWUsXG4gICAgd2luZG93LmxvY2F0aW9uLm9yaWdpbiArIHBhdGhOYW1lXG4gICAgKTtcbn07XG5cblxuLy8g0J7RgtGA0LjRgdC+0LLQutCwINGB0YLRgNCw0L3QuNGG0Ysg0L/RgNC4INGB0LzQtdC90LUgdXJsXG5cbndpbmRvdy5vbnBvcHN0YXRlID0gZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgZmlsdGVyKCk7XG4gICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gXCIvXCIpIHtcbiAgICAgICAgY2xlYXJDb250YWluZXIoKTtcbiAgICAgICAgbGV0IHNlY3Rpb25DYXJkcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlY3Rpb24nKTtcbiAgICAgICAgc2VjdGlvbkNhcmRzLmNsYXNzTGlzdC5hZGQoJ2NhcmRzJyk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmQoc2VjdGlvbkNhcmRzKTtcbiAgICAgICAgbWFpbkJsb2NrID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRzJyk7XG4gICAgICAgIGxvYWREZWZhdWx0UGFnZXMoKTtcbiAgICAgICAgZmlsdGVyKCk7XG4gICAgfTtcblxuICAgIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09IFwiL211bHRpa2FydGEtZml0bmVzcy1ob3VzZVwiKSB7XG4gICAgICAgIGNsZWFyQ29udGFpbmVyKCk7XG4gICAgICAgIGZldGNoKCdzZXJ2aWNlLmpzb24nKVxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG4gICAgICAgIC50aGVuKGFuc3dlciA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhbnN3ZXIuc2VydmljZXM7XG4gICAgICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgICAgICBzaG93U2luZ2xlQ2FyZChyZXN1bHQsIGkpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gXCIvYWJvbmVtZW50LWZpdG5lc3MtaG91c2VcIikge1xuICAgICAgICBjbGVhckNvbnRhaW5lcigpO1xuICAgICAgICBmZXRjaCgnc2VydmljZS5qc29uJylcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxuICAgICAgICAudGhlbihhbnN3ZXIgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYW5zd2VyLnNlcnZpY2VzO1xuICAgICAgICAgICAgbGV0IGkgPSAxO1xuICAgICAgICAgICAgc2hvd1NpbmdsZUNhcmQocmVzdWx0LCBpKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09IFwiL2RldHNrYXlhLXNla2NpYS12b2RhXCIpIHtcbiAgICAgICAgY2xlYXJDb250YWluZXIoKTtcbiAgICAgICAgZmV0Y2goJ3NlcnZpY2UuanNvbicpXG4gICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcbiAgICAgICAgLnRoZW4oYW5zd2VyID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGFuc3dlci5zZXJ2aWNlcztcbiAgICAgICAgICAgIGxldCBpID0gMjtcbiAgICAgICAgICAgIHNob3dTaW5nbGVDYXJkKHJlc3VsdCwgaSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSBcIi9wYWtldC1wcnNvbmFsbmloLXRyZW5pcm92b2tcIikge1xuICAgICAgICBjbGVhckNvbnRhaW5lcigpO1xuICAgICAgICBmZXRjaCgnc2VydmljZS5qc29uJylcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxuICAgICAgICAudGhlbihhbnN3ZXIgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYW5zd2VyLnNlcnZpY2VzO1xuICAgICAgICAgICAgbGV0IGkgPSAzO1xuICAgICAgICAgICAgc2hvd1NpbmdsZUNhcmQocmVzdWx0LCBpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gXCIvZ3J1cHBvdmllLXphbmF0aXlhXCIpIHtcbiAgICAgICAgY2xlYXJDb250YWluZXIoKTtcbiAgICAgICAgZmV0Y2goJ3NlcnZpY2UuanNvbicpXG4gICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcbiAgICAgICAgLnRoZW4oYW5zd2VyID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGFuc3dlci5zZXJ2aWNlcztcbiAgICAgICAgICAgIGxldCBpID0gNDtcbiAgICAgICAgICAgIHNob3dTaW5nbGVDYXJkKHJlc3VsdCwgaSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09IFwiL21hc3Rlci1jbGFzc1wiKSB7XG4gICAgICAgIGNsZWFyQ29udGFpbmVyKCk7XG4gICAgICAgIGZldGNoKCdzZXJ2aWNlLmpzb24nKVxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG4gICAgICAgIC50aGVuKGFuc3dlciA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhbnN3ZXIuc2VydmljZXM7XG4gICAgICAgICAgICBsZXQgaSA9IDU7XG4gICAgICAgICAgICBzaG93U2luZ2xlQ2FyZChyZXN1bHQsIGkpO1xuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG5cbi8vINCk0YPQvdC60YbQuNGPINGA0L7Rg9GC0LjQvdCz0LBcblxuZnVuY3Rpb24gY2hhbmdlUm91dGluZyhhdHRyLCByZXN1bHQpIHtcbiAgICBzd2l0Y2goYXR0cikge1xuICAgICAgICBjYXNlICdtdWx0aWthcnRhLWZpdG5lc3MtaG91c2UnIDoge1xuICAgICAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICAgICAgc2hvd1NpbmdsZUNhcmQocmVzdWx0LCBpKTtcbiAgICAgICAgICAgIG5hdmlnYXRpb25Ub0dvKCcvbXVsdGlrYXJ0YS1maXRuZXNzLWhvdXNlJyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfTtcbiAgICAgICAgY2FzZSAnYWJvbmVtZW50LWZpdG5lc3MtaG91c2UnIDoge1xuICAgICAgICAgICAgbGV0IGkgPSAxO1xuICAgICAgICAgICAgc2hvd1NpbmdsZUNhcmQocmVzdWx0LCBpKTtcbiAgICAgICAgICAgIG5hdmlnYXRpb25Ub0dvKCcvYWJvbmVtZW50LWZpdG5lc3MtaG91c2UnKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9O1xuICAgICAgICBjYXNlICdkZXRza2F5YS1zZWtjaWEtdm9kYScgOiB7XG4gICAgICAgICAgICBsZXQgaSA9IDI7XG4gICAgICAgICAgICBzaG93U2luZ2xlQ2FyZChyZXN1bHQsIGkpO1xuICAgICAgICAgICAgbmF2aWdhdGlvblRvR28oJy9kZXRza2F5YS1zZWtjaWEtdm9kYScpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH07XG4gICAgICAgIGNhc2UgJ3Bha2V0LXByc29uYWxuaWgtdHJlbmlyb3ZvaycgOiB7XG4gICAgICAgICAgICBsZXQgaSA9IDM7XG4gICAgICAgICAgICBzaG93U2luZ2xlQ2FyZChyZXN1bHQsIGkpO1xuICAgICAgICAgICAgbmF2aWdhdGlvblRvR28oJy9wYWtldC1wcnNvbmFsbmloLXRyZW5pcm92b2snKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9O1xuICAgICAgICBjYXNlICdncnVwcG92aWUtemFuYXRpeWEnIDoge1xuICAgICAgICAgICAgbGV0IGkgPSA0O1xuICAgICAgICAgICAgc2hvd1NpbmdsZUNhcmQocmVzdWx0LCBpKTtcbiAgICAgICAgICAgIG5hdmlnYXRpb25Ub0dvKCcvZ3J1cHBvdmllLXphbmF0aXlhJyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfTtcbiAgICAgICAgY2FzZSAnbWFzdGVyLWNsYXNzJyA6IHtcbiAgICAgICAgICAgIGxldCBpID0gNTtcbiAgICAgICAgICAgIHNob3dTaW5nbGVDYXJkKHJlc3VsdCwgaSk7XG4gICAgICAgICAgICBuYXZpZ2F0aW9uVG9HbygnL21hc3Rlci1jbGFzcycpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5cbi8vINCk0LjQu9GM0YLRgNCw0YbQuNGPINGN0LvQtdC80LXQvdGC0L7QslxuXG5maWx0ZXIoKTtcblxuZnVuY3Rpb24gZmlsdGVyKCkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBjb25zdCBzZWxlY3RzID0gQXJyYXkuZnJvbShkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzZWxlY3QnKSk7XG4gICAgICAgIGNvbnN0IGJsb2NrcyA9IEFycmF5LmZyb20oZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY2FyZHMtLWl0ZW0nKSk7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0ge307XG5cbiAgICAgICAgZnVuY3Rpb24gaGlkZUJsb2NrKGJsb2NrKSB7XG4gICAgICAgICAgICBibG9jay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIHNob3dCbG9jayhibG9jaykge1xuICAgICAgICAgICAgYmxvY2suc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlUXVlcnkoZSkge1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZFF1ZXJ5ID0gZS50YXJnZXQuZGF0YXNldFsncXVlcnknXTtcbiAgICBcbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC52YWx1ZSkge1xuICAgICAgICAgICAgcXVlcnlbdXBkYXRlZFF1ZXJ5XSA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZGVsZXRlIHF1ZXJ5W3VwZGF0ZWRRdWVyeV07XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgY29uc3QgYmxvY2tzVG9TaG93ID0gYmxvY2tzLmZpbHRlcihibG9jayA9PiB7XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMocXVlcnkpLmV2ZXJ5KChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgICAgIHJldHVybiBibG9jay5kYXRhc2V0W2tleV0gPT09IHZhbHVlO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIFxuICAgICAgICBibG9ja3MuZm9yRWFjaChibG9jayA9PiBoaWRlQmxvY2soYmxvY2spKTtcbiAgICAgICAgYmxvY2tzVG9TaG93LmZvckVhY2goYmxvY2sgPT4gc2hvd0Jsb2NrKGJsb2NrKSk7XG4gICAgfTtcblxuICAgIHNlbGVjdHMuZm9yRWFjaChzZWxlY3QgPT4gc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHVwZGF0ZVF1ZXJ5KSk7XG4gICAgfSwgMTAwMCk7XG59O1xuIl19
